<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>JARVIS HUD</title>

<!-- REAL BROWSER AI (NO PYTHON, NO SERVER) -->
<script src="https://cdn.jsdelivr.net/npm/@mlc-ai/web-llm/dist/index.js"></script>

<style>
body {
    margin: 0;
    background: #05080c;
    color: #00ffcc;
    font-family: Arial, sans-serif;
    overflow: hidden;
}
#reactor {
    width: 220px;
    height: 220px;
    border-radius: 50%;
    border: 4px solid #00ffcc;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    box-shadow: 0 0 25px #00ffcc;
}
.thinking {
    box-shadow: 0 0 55px #00e5ff;
    border-color: #00e5ff;
}
#console {
    position: absolute;
    bottom: 120px;
    left: 20px;
    width: 60%;
    height: 180px;
    background: #020406;
    padding: 10px;
    overflow-y: auto;
    font-family: monospace;
}
#input {
    position: absolute;
    bottom: 40px;
    left: 20px;
    width: 60%;
    padding: 10px;
    font-size: 16px;
    background: #0b1117;
    color: white;
    border: none;
    outline: none;
}
#modules {
    position: absolute;
    top: 20px;
    right: 20px;
    font-family: monospace;
    background: rgba(0,0,0,0.3);
    padding: 10px;
    display: none;
}
#modules div { margin-bottom: 5px; }
</style>
</head>
<body>

<div id="reactor"></div>
<div id="console"></div>
<input id="input" placeholder="Talk to Jarvis…">

<div id="modules">
    <div id="arduino">ARDUINO: OFF</div>
    <div id="printer">3D PRINTER: IDLE</div>
    <div id="soldering">SOLDERING IRON: OFF</div>
    <div id="led">LED STRIP: OFF</div>
    <div id="sensor">SENSOR: IDLE</div>
    <div id="servo">SERVO: IDLE</div>
</div>

<script>
const consoleBox = document.getElementById("console");
const input = document.getElementById("input");
const reactor = document.getElementById("reactor");
const modules = document.getElementById("modules");

const arduino = document.getElementById("arduino");
const printer = document.getElementById("printer");
const soldering = document.getElementById("soldering");
const led = document.getElementById("led");
const sensor = document.getElementById("sensor");
const servo = document.getElementById("servo");

// ---------------- MEMORY ----------------
let jarvis = {
    name: localStorage.getItem("jarvis_name") || null,
    recent: JSON.parse(localStorage.getItem("jarvis_recent")) || [],
    project: JSON.parse(localStorage.getItem("jarvis_project")) || {name:null, steps:[], current:0},
    music: "https://music.youtube.com/"
};

function saveMemory(){
    localStorage.setItem("jarvis_name", jarvis.name || "");
    localStorage.setItem("jarvis_recent", JSON.stringify(jarvis.recent));
    localStorage.setItem("jarvis_project", JSON.stringify(jarvis.project));
}

// ---------------- UI ----------------
function log(text){
    consoleBox.innerHTML += text + "<br>";
    consoleBox.scrollTop = consoleBox.scrollHeight;
}

function speak(text, delay=400){
    reactor.classList.add("thinking");
    setTimeout(()=>{
        reactor.classList.remove("thinking");
        log("Jarvis: " + text);
        speechSynthesis.speak(new SpeechSynthesisUtterance(text));
    }, delay);
}

// ---------------- MAKER AI ----------------
function makerAI(cmd){
    cmd = cmd.toLowerCase();
    if(cmd.includes("arduino")) return "Arduino ready. Double-check power and grounding.";
    if(cmd.includes("3d printer")) return "Check bed leveling and filament before printing.";
    if(cmd.includes("solder")) return "Heat the joint, not the solder.";
    return null;
}

// ---------------- PROJECT SYSTEM ----------------
function startProject(name){
    jarvis.project = {name, steps:[], current:0};
    saveMemory();
    speak(`Project ${name} started.`);
}
function nextStep(step){
    jarvis.project.steps.push(step);
    saveMemory();
    speak("Step added.");
}
function whatsNext(){
    if(jarvis.project.current >= jarvis.project.steps.length){
        speak("No remaining steps.");
        return;
    }
    speak(jarvis.project.steps[jarvis.project.current++]);
    saveMemory();
}

// ---------------- REAL AI ----------------
let engine = null;
let aiReady = false;

async function initAI(){
    speak("Loading my brain…");
    engine = await webllm.CreateMLCEngine(
        "Llama-3-8B-Instruct-q4f32_1"
    );
    aiReady = true;
    speak("Brain online. I’m here.");
}

async function brainAI(text){
    if(!aiReady){
        speak("Still warming up.");
        return;
    }
    const res = await engine.chat.completions.create({
        messages: [{ role: "user", content: text }]
    });
    speak(res.choices[0].message.content);
}

// ---------------- COMMAND HANDLER ----------------
function handle(cmd){
    if(!cmd) return;
    log("You: " + cmd);
    jarvis.recent.push(cmd);
    if(jarvis.recent.length > 10) jarvis.recent.shift();
    saveMemory();

    const lower = cmd.toLowerCase();

    if(lower.startsWith("my name is")){
        jarvis.name = cmd.replace("my name is","").trim();
        saveMemory();
        speak(`I’ll remember you, ${jarvis.name}.`);
        return;
    }

    if(lower.startsWith("start project ")) return startProject(cmd.slice(14));
    if(lower.startsWith("next step ")) return nextStep(cmd.slice(10));
    if(lower.includes("what's next")) return whatsNext();

    if(lower.includes("show modules")){ modules.style.display="block"; speak("Modules online."); return; }
    if(lower.includes("hide modules")){ modules.style.display="none"; speak("Modules hidden."); return; }

    if(lower.includes("turn on soldering")){ soldering.textContent="SOLDERING IRON: ON"; speak("Soldering iron on."); return; }
    if(lower.includes("start 3d printer")){ printer.textContent="3D PRINTER: PRINTING"; speak("Printer started."); return; }

    if(lower.includes("music")){ window.open(jarvis.music,"_blank"); speak("Playing music."); return; }

    const maker = makerAI(cmd);
    if(maker){ speak(maker); return; }

    // REAL AI FALLBACK
    brainAI(cmd);
}

// ---------------- INPUT ----------------
input.addEventListener("keydown", e=>{
    if(e.key === "Enter"){
        handle(input.value);
        input.value = "";
    }
});

// ---------------- ANIMATION ----------------
let angle = 0;
function animate(){
    reactor.style.transform = `translate(-50%, -50%) rotate(${angle}deg)`;
    angle += 1;
    requestAnimationFrame(animate);
}

// ---------------- BOOT ----------------
speak("Jarvis online.");
animate();
initAI();
</script>
</body>
</html>

